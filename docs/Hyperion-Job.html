<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Hyperion.Job</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">hyperion-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="src/Hyperion.Job.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Hyperion.Job</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">General comments</a></li><li><a href="#g:2">Documentation</a></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:JobEnv">JobEnv</a> = <a href="#v:JobEnv">JobEnv</a> {<ul class="subs"><li><a href="#v:jobDatabaseConfig">jobDatabaseConfig</a> :: <a href="Hyperion-Database-HasDB.html#t:DatabaseConfig" title="Hyperion.Database.HasDB">DatabaseConfig</a></li><li><a href="#v:jobNodeCpus">jobNodeCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a></li><li><a href="#v:jobTaskCpus">jobTaskCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a></li><li><a href="#v:jobProgramInfo">jobProgramInfo</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a></li><li><a href="#v:jobTaskLauncher">jobTaskLauncher</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:NodeLauncherConfig">NodeLauncherConfig</a> = <a href="#v:NodeLauncherConfig">NodeLauncherConfig</a> {<ul class="subs"><li><a href="#v:nodeLogDir">nodeLogDir</a> :: <a href="../base-4.14.1.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a></li><li><a href="#v:nodeSshCmd">nodeSshCmd</a> :: <a href="Hyperion-WorkerCpuPool.html#t:SSHCommand" title="Hyperion.WorkerCpuPool">SSHCommand</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Job">Job</a> = <a href="../mtl-2.2.2/Control-Monad-Reader.html#t:ReaderT" title="Control.Monad.Reader">ReaderT</a> <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> Process</li><li class="src short"><a href="#v:setTaskCpus">setTaskCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> -&gt; <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></li><li class="src short"><a href="#v:runJobSlurm">runJobSlurm</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a> -&gt; <a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> a -&gt; Process a</li><li class="src short"><a href="#v:runJobLocal">runJobLocal</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a> -&gt; <a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> a -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:workerLauncherWithRunCmd">workerLauncherWithRunCmd</a> :: <a href="../base-4.14.1.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.14.1.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; ((<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; Process ()) -&gt; m (<a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>)</li><li class="src short"><a href="#v:withNodeLauncher">withNodeLauncher</a> :: <a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a> -&gt; <a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a> -&gt; (<a href="../base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a>, <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>) -&gt; Process a) -&gt; Process a</li><li class="src short"><a href="#v:runCmdLocalAsync">runCmdLocalAsync</a> :: (<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:runCmdLocalLog">runCmdLocalLog</a> :: (<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:withPoolLauncher">withPoolLauncher</a> :: <a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a> -&gt; [<a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a>] -&gt; ((<a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>) -&gt; Process a) -&gt; Process a</li><li class="src short"><a href="#v:remoteEvalJobM">remoteEvalJobM</a> :: (Static (<a href="../binary-0.8.8.0/Data-Binary.html#t:Binary" title="Data.Binary">Binary</a> b), <a href="../base-4.14.1.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> b) =&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> (<a href="../distributed-static-0.3.9/Control-Distributed-Static.html#t:Closure" title="Control.Distributed.Static">Closure</a> (<a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> b)) -&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> b</li><li class="src short"><a href="#v:remoteEvalJob">remoteEvalJob</a> :: (Static (<a href="../binary-0.8.8.0/Data-Binary.html#t:Binary" title="Data.Binary">Binary</a> b), <a href="../base-4.14.1.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> b) =&gt; <a href="../distributed-static-0.3.9/Control-Distributed-Static.html#t:Closure" title="Control.Distributed.Static">Closure</a> (<a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> b) -&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> b</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>General comments</h1></a><div class="doc"><p>In this module we define the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> monad. It is nothing more than <code>Process</code>
 together with <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> environment.</p><p>The <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> environment represents the environment of a job running under
 <code>SLURM</code>. We should think about a computation in <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> as being run on a
 node allocated for the job by <code>SLURM</code> and running remote computations on the
 resources allocated to the job. The <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> environment
 contains</p><ul><li>information about the master program that scheduled the job,</li><li>information about the database used for recording results of the calculations,</li><li>number of CPUs available per node, as well as the number of CPUs to
       use for remote computations spawned from the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> computation (<code><a href="Hyperion-Job.html#v:jobTaskCpus" title="Hyperion.Job">jobTaskCpus</a></code>),</li><li><code><a href="Hyperion-Job.html#v:jobTaskLauncher" title="Hyperion.Job">jobTaskLauncher</a></code>, which allocates <code><a href="Hyperion-Job.html#v:jobTaskCpus" title="Hyperion.Job">jobTaskCpus</a></code> CPUs on some node from
       the resources available to the job and launches a worker on that node.
       That worker is then allowed to use the allocated number of CPUs.
       Thanks to <code><a href="Hyperion-Job.html#v:jobTaskLauncher" title="Hyperion.Job">jobTaskLauncher</a></code>, <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> is an instance of <code><a href="Hyperion-Remote.html#v:HasWorkers" title="Hyperion.Remote">HasWorkers</a></code> and
       we can use functions such as <code><a href="Hyperion-Remote.html#v:remoteEval" title="Hyperion.Remote">remoteEval</a></code>.</li></ul><p>The common usecase is that the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> computation is spawned from a <code><a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a></code>
 calculation on login node via, e.g., <code><a href="Hyperion-Job.html#v:remoteEvalJob" title="Hyperion.Job">remoteEvalJob</a></code> (which acquires job
 resources from <code>SLURM</code>). The <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> computation then manages the job resources
 and runs remote computations in the allocation via, e.g., <code><a href="Hyperion-Remote.html#v:remoteEval" title="Hyperion.Remote">remoteEval</a></code>.</p></div><a href="#g:2" id="g:2"><h1>Documentation</h1></a><div class="doc empty">&nbsp;</div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:JobEnv" class="def">JobEnv</a> <a href="src/Hyperion.Job.html#JobEnv" class="link">Source</a> <a href="#t:JobEnv" class="selflink">#</a></p><div class="doc"><p>The environment type for <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> monad.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:JobEnv" class="def">JobEnv</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:jobDatabaseConfig" class="def">jobDatabaseConfig</a> :: <a href="Hyperion-Database-HasDB.html#t:DatabaseConfig" title="Hyperion.Database.HasDB">DatabaseConfig</a></dfn><div class="doc"><p><code><a href="Hyperion-Database-HasDB.html#t:DatabaseConfig" title="Hyperion.Database.HasDB">DatabaseConfig</a></code> for the database to use</p></div></li><li><dfn class="src"><a id="v:jobNodeCpus" class="def">jobNodeCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a></dfn><div class="doc"><p>Number of CPUs available on each node in the job</p></div></li><li><dfn class="src"><a id="v:jobTaskCpus" class="def">jobTaskCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a></dfn><div class="doc"><p>Number of CPUs to use for running remote functions</p></div></li><li><dfn class="src"><a id="v:jobProgramInfo" class="def">jobProgramInfo</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a></dfn><div class="doc"><p><code><a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a></code> inherited from the master</p></div></li><li><dfn class="src"><a id="v:jobTaskLauncher" class="def">jobTaskLauncher</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a></dfn><div class="doc"><p>a <code><a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a></code> that runs workers with the given number of CPUs allocated</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:JobEnv">Instances</h4><details id="i:JobEnv" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:JobEnv:HasWorkerLauncher:1"></span> <a href="Hyperion-HasWorkers.html#t:HasWorkerLauncher" title="Hyperion.HasWorkers">HasWorkerLauncher</a> <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></span> <a href="src/Hyperion.Job.html#line-116" class="link">Source</a> <a href="#t:JobEnv" class="selflink">#</a></td><td class="doc"><p>Make <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> an instance of <code><a href="Hyperion-HasWorkers.html#t:HasWorkerLauncher" title="Hyperion.HasWorkers">HasWorkerLauncher</a></code>. The <code><a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a></code> returned
 by <code><a href="Hyperion-HasWorkers.html#v:toWorkerLauncher" title="Hyperion.HasWorkers">toWorkerLauncher</a></code> launches workers with <code><a href="Hyperion-Job.html#v:jobTaskCpus" title="Hyperion.Job">jobTaskCpus</a></code> CPUs available to them.</p><p>This makes <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> an instance of <code>HasWorkers</code> and gives us access to functions in
 <a href="Hyperion-Remote.html">Hyperion.Remote</a>.</p></td></tr><tr><td colspan="2"><details id="i:id:JobEnv:HasWorkerLauncher:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Hyperion-Job.html">Hyperion.Job</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toWorkerLauncher">toWorkerLauncher</a> :: <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> -&gt; <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a> <a href="src/Hyperion.HasWorkers.html#toWorkerLauncher" class="link">Source</a> <a href="#v:toWorkerLauncher" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:JobEnv:HasDB:2"></span> <a href="Hyperion-Database-HasDB.html#t:HasDB" title="Hyperion.Database.HasDB">HasDB</a> <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></span> <a href="src/Hyperion.Job.html#line-105" class="link">Source</a> <a href="#t:JobEnv" class="selflink">#</a></td><td class="doc"><p>Make <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> an instance of <code><a href="Hyperion-Database-HasDB.html#t:HasDB" title="Hyperion.Database.HasDB">HasDB</a></code>.</p></td></tr><tr><td colspan="2"><details id="i:id:JobEnv:HasDB:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Hyperion-Job.html">Hyperion.Job</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:dbConfigLens">dbConfigLens</a> :: Lens' <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> <a href="Hyperion-Database-HasDB.html#t:DatabaseConfig" title="Hyperion.Database.HasDB">DatabaseConfig</a> <a href="src/Hyperion.Database.HasDB.html#dbConfigLens" class="link">Source</a> <a href="#v:dbConfigLens" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:JobEnv:HasProgramInfo:3"></span> <a href="Hyperion-Cluster.html#t:HasProgramInfo" title="Hyperion.Cluster">HasProgramInfo</a> <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></span> <a href="src/Hyperion.Job.html#line-92" class="link">Source</a> <a href="#t:JobEnv" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:JobEnv:HasProgramInfo:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Hyperion-Job.html">Hyperion.Job</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toProgramInfo">toProgramInfo</a> :: <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> -&gt; <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a> <a href="src/Hyperion.Cluster.html#toProgramInfo" class="link">Source</a> <a href="#v:toProgramInfo" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:NodeLauncherConfig" class="def">NodeLauncherConfig</a> <a href="src/Hyperion.Job.html#NodeLauncherConfig" class="link">Source</a> <a href="#t:NodeLauncherConfig" class="selflink">#</a></p><div class="doc"><p>Configuration for <code><a href="Hyperion-Job.html#v:withNodeLauncher" title="Hyperion.Job">withNodeLauncher</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:NodeLauncherConfig" class="def">NodeLauncherConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:nodeLogDir" class="def">nodeLogDir</a> :: <a href="../base-4.14.1.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a></dfn><div class="doc"><p>The directory to which the workers shall log.</p></div></li><li><dfn class="src"><a id="v:nodeSshCmd" class="def">nodeSshCmd</a> :: <a href="Hyperion-WorkerCpuPool.html#t:SSHCommand" title="Hyperion.WorkerCpuPool">SSHCommand</a></dfn><div class="doc"><p>The command used to run <code>ssh</code>. See <code><a href="Hyperion-WorkerCpuPool.html#t:SSHCommand" title="Hyperion.WorkerCpuPool">SSHCommand</a></code> for description.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Job" class="def">Job</a> = <a href="../mtl-2.2.2/Control-Monad-Reader.html#t:ReaderT" title="Control.Monad.Reader">ReaderT</a> <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> Process <a href="src/Hyperion.Job.html#Job" class="link">Source</a> <a href="#t:Job" class="selflink">#</a></p><div class="doc"><p><code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> monad is simply <code>Process</code> with <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> environment.</p></div></div><div class="top"><p class="src"><a id="v:setTaskCpus" class="def">setTaskCpus</a> :: <a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> -&gt; <a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a> <a href="src/Hyperion.Job.html#setTaskCpus" class="link">Source</a> <a href="#v:setTaskCpus" class="selflink">#</a></p><div class="doc"><p>Changses <code><a href="Hyperion-Job.html#v:jobTaskCpus" title="Hyperion.Job">jobTaskCpus</a></code> in <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code></p></div></div><div class="top"><p class="src"><a id="v:runJobSlurm" class="def">runJobSlurm</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a> -&gt; <a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> a -&gt; Process a <a href="src/Hyperion.Job.html#runJobSlurm" class="link">Source</a> <a href="#v:runJobSlurm" class="selflink">#</a></p><div class="doc"><p>Runs the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> monad assuming we are inside a SLURM job. In
 practice it just fills in the environment <code><a href="Hyperion-Job.html#t:JobEnv" title="Hyperion.Job">JobEnv</a></code> and calls
 <code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:runReaderT" title="Control.Monad.Reader">runReaderT</a></code>. The environment is mostly constructed from <code>SLURM</code>
 environment variables and <code><a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a></code>. The exceptions to these
 are <code><a href="Hyperion-Job.html#v:jobTaskCpus" title="Hyperion.Job">jobTaskCpus</a></code>, which is set to <code><code><a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a></code> 1</code>, and
 <code><a href="Hyperion-Job.html#v:jobTaskLauncher" title="Hyperion.Job">jobTaskLauncher</a></code>, which is created by <code><a href="Hyperion-Job.html#v:withPoolLauncher" title="Hyperion.Job">withPoolLauncher</a></code>.
 The log file has the form &quot;/a/b/c/progid/serviceid.log&quot;
 . The log directory for the node is obtained by dropping
 the .log extension: &quot;/a/b/c/progid/serviceid&quot;</p></div></div><div class="top"><p class="src"><a id="v:runJobLocal" class="def">runJobLocal</a> :: <a href="Hyperion-Cluster.html#t:ProgramInfo" title="Hyperion.Cluster">ProgramInfo</a> -&gt; <a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> a -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Hyperion.Job.html#runJobLocal" class="link">Source</a> <a href="#v:runJobLocal" class="selflink">#</a></p><div class="doc"><p>Runs the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> locally in IO without using any information from a
 SLURM environment, with some basic default settings. This function
 is provided primarily for testing.</p></div></div><div class="top"><p class="src"><a id="v:workerLauncherWithRunCmd" class="def">workerLauncherWithRunCmd</a> :: <a href="../base-4.14.1.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.14.1.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; ((<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; Process ()) -&gt; m (<a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>) <a href="src/Hyperion.Job.html#workerLauncherWithRunCmd" class="link">Source</a> <a href="#v:workerLauncherWithRunCmd" class="selflink">#</a></p><div class="doc"><p><code><a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a></code> that uses the supplied command runner to launch
 workers.  Sets <code><a href="Hyperion-Remote.html#v:connectionTimeout" title="Hyperion.Remote">connectionTimeout</a></code> to <code><a href="../base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code>. Uses the
 <code><a href="Hyperion-Remote.html#t:ServiceId" title="Hyperion.Remote">ServiceId</a></code> supplied to <code><a href="Hyperion-Remote.html#v:withLaunchedWorker" title="Hyperion.Remote">withLaunchedWorker</a></code> to construct <code><a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a></code>
 (through <code><a href="Hyperion-Slurm-JobId.html#v:JobName" title="Hyperion.Slurm.JobId">JobName</a></code>).  The supplied <code><a href="../base-4.14.1.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a></code> is used as log
 directory for the worker, with the log file name derived from
 <code><a href="Hyperion-Remote.html#t:ServiceId" title="Hyperion.Remote">ServiceId</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:withNodeLauncher" class="def">withNodeLauncher</a> :: <a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a> -&gt; <a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a> -&gt; (<a href="../base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a>, <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>) -&gt; Process a) -&gt; Process a <a href="src/Hyperion.Job.html#withNodeLauncher" class="link">Source</a> <a href="#v:withNodeLauncher" class="selflink">#</a></p><div class="doc"><p>Given a <code><a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a></code> and a <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code> runs the continuation
 <code><a href="../base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a></code> passing it a pair <code>(<code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code>, <code><a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a></code>
 <code><a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a></code>)</code>.  Passing <code><a href="../base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> repersents <code>ssh</code> failure.</p><p>While <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code> is preserved, the passed <code><a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a></code>
 launches workers on the node at <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code>. The launcher is
 derived from <code><a href="Hyperion-Job.html#v:workerLauncherWithRunCmd" title="Hyperion.Job">workerLauncherWithRunCmd</a></code>, where command runner is
 either local shell (if <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code> is <code>LocalHost</code>) or a
 <code>RemoteFunction</code> that runs the local shell on <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code> via
 <code><a href="Hyperion-Remote.html#v:withRemoteRunProcess" title="Hyperion.Remote">withRemoteRunProcess</a></code> and related functions (if <code><a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a></code> is
 <code>RemoteAddr</code>).</p><p>Note that the process of launching a worker on the remote node will
 actually spawn an &quot;utility&quot; worker there that will launch all new
 workers in the continuation.  This utility worker will have its log
 in the log dir, identified by some random <code><a href="Hyperion-Remote.html#t:ServiceId" title="Hyperion.Remote">ServiceId</a></code> and put
 messages like &quot;Running command ...&quot;.</p><p>The reason that utility workers are used on each Job node is to
 minimize the number of calls to <code>ssh</code> or <code>srun</code>. The naive way to
 launch workers in the <code><a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a></code> monad would be to determine what node
 they should be run on, and run the hyperion worker command via
 <code>ssh</code>. Unfortunately, many clusters have flakey <code>ssh</code>
 configurations that start throwing errors if <code>ssh</code> is called too
 many times in quick succession. <code>ssh</code> also has to perform
 authentication. Experience shows that <code>srun</code> is also not a good
 solution to this problem, since <code>srun</code> talks to <code>SLURM</code> to manage
 resources and this can take a long time, affecting
 performance. Instead, we <code>ssh</code> exactly once to each node in the Job
 (besides the head node), and start utility workers there. These
 workers can then communicate with the head node via the usual
 machinery of <code>hyperion</code> --- effectively, we keep a connection open
 to each node so that we no longer have to use <code>ssh</code>.</p></div></div><div class="top"><p class="src"><a id="v:runCmdLocalAsync" class="def">runCmdLocalAsync</a> :: (<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Hyperion.Job.html#runCmdLocalAsync" class="link">Source</a> <a href="#v:runCmdLocalAsync" class="selflink">#</a></p><div class="doc"><p>Run the given command in a child thread. Async.link ensures
 that exceptions from the child are propagated to the parent.</p><p>NB: Previously, this function used <code><a href="../process-1.6.9.0/System-Process.html#v:createProcess" title="System.Process">createProcess</a></code>
 and discarded the resulting <code>ProcessHandle</code>. This could result in
 &quot;insufficient resource&quot; errors for OS threads. Hopefully the
 current implementation avoids this problem.</p></div></div><div class="top"><p class="src"><a id="v:runCmdLocalLog" class="def">runCmdLocalLog</a> :: (<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>, [<a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a>]) -&gt; <a href="../base-4.14.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Hyperion.Job.html#runCmdLocalLog" class="link">Source</a> <a href="#v:runCmdLocalLog" class="selflink">#</a></p><div class="doc"><p>Run the given command and log the command. This is suitable
 for running on remote machines so we can keep track of what is
 being run where.</p></div></div><div class="top"><p class="src"><a id="v:withPoolLauncher" class="def">withPoolLauncher</a> :: <a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a> -&gt; [<a href="Hyperion-WorkerCpuPool.html#t:WorkerAddr" title="Hyperion.WorkerCpuPool">WorkerAddr</a>] -&gt; ((<a href="Hyperion-WorkerCpuPool.html#t:NumCPUs" title="Hyperion.WorkerCpuPool">NumCPUs</a> -&gt; <a href="Hyperion-Remote.html#t:WorkerLauncher" title="Hyperion.Remote">WorkerLauncher</a> <a href="Hyperion-Slurm-JobId.html#t:JobId" title="Hyperion.Slurm.JobId">JobId</a>) -&gt; Process a) -&gt; Process a <a href="src/Hyperion.Job.html#withPoolLauncher" class="link">Source</a> <a href="#v:withPoolLauncher" class="selflink">#</a></p><div class="doc"><p>Takes a <code><a href="Hyperion-Job.html#t:NodeLauncherConfig" title="Hyperion.Job">NodeLauncherConfig</a></code> and a list of addresses. Tries to
 start &quot;worker-launcher&quot; workers on these addresses (see
 <code><a href="Hyperion-Job.html#v:withNodeLauncher" title="Hyperion.Job">withNodeLauncher</a></code>).  Discards addresses on which the this
 fails. From remaining addresses builds a worker CPU pool. The
 continuation is then passed a function that launches workers in
 this pool. The <code>WorkerLaunchers</code> that continuation gets have
 <code><a href="Hyperion-Remote.html#v:connectionTimeout" title="Hyperion.Remote">connectionTimeout</a></code> to <code><a href="../base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:remoteEvalJobM" class="def">remoteEvalJobM</a> :: (Static (<a href="../binary-0.8.8.0/Data-Binary.html#t:Binary" title="Data.Binary">Binary</a> b), <a href="../base-4.14.1.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> b) =&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> (<a href="../distributed-static-0.3.9/Control-Distributed-Static.html#t:Closure" title="Control.Distributed.Static">Closure</a> (<a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> b)) -&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> b <a href="src/Hyperion.Job.html#remoteEvalJobM" class="link">Source</a> <a href="#v:remoteEvalJobM" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:remoteEvalJob" class="def">remoteEvalJob</a> :: (Static (<a href="../binary-0.8.8.0/Data-Binary.html#t:Binary" title="Data.Binary">Binary</a> b), <a href="../base-4.14.1.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> b) =&gt; <a href="../distributed-static-0.3.9/Control-Distributed-Static.html#t:Closure" title="Control.Distributed.Static">Closure</a> (<a href="Hyperion-Job.html#t:Job" title="Hyperion.Job">Job</a> b) -&gt; <a href="Hyperion-Cluster.html#t:Cluster" title="Hyperion.Cluster">Cluster</a> b <a href="src/Hyperion.Job.html#remoteEvalJob" class="link">Source</a> <a href="#v:remoteEvalJob" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.0</p></div></body></html>