<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass      #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StaticPointers      #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hyperion.Remote</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isEmptyMVar</span></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Distributed.Process</span></span><span>         </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catch</span></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Distributed.Process.Async</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AsyncResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">async</span></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">task</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">wait</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Distributed.Process.Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SerializableDict</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Distributed.Process.Node</span></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Distributed.Static</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">registerStatic</span></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">staticLabel</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SomeException</span></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwM</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Extra</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">whenM</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Binary</span></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Binary</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Constraint</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Dict</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">asum</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Rank1Dynamic</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toDynamic</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Time.Clock</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NominalDiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Hyperion.CallClosure.html"><span class="hs-identifier">Hyperion.CallClosure</span></a></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.CallClosure.html#call%27"><span class="hs-identifier">call'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Hyperion.Log.html"><span class="hs-identifier">Hyperion.Log</span></a></span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Log</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Hyperion.Static</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Serializable</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ptrAp</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Hyperion.Util.html"><span class="hs-identifier">Hyperion.Util</span></a></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Util.html#nominalDiffTimeToMicroseconds"><span class="hs-identifier">nominalDiffTimeToMicroseconds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>                                                      </span><span class="annot"><a href="Hyperion.Util.html#newUnique"><span class="hs-identifier">newUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.BSD</span></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HostEntry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">getHostEntries</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>                                                      </span><span class="annot"><span class="hs-identifier">getHostName</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hostAddressToTuple</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.Transport</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EndPointAddress</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.Transport.TCP</span></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NT</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- * Types</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- | Type for service id. 'ServiceId' is typically a random string that</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- is assigned to a worker. (Maybe to other things too?)</span><span>
</span><span id="line-55"></span><span id="local-6989586621679159228"><span id="local-6989586621679159229"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="ServiceId"><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-var">ServiceId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServiceId"><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-var">ServiceId</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159223"><span id="local-6989586621679159225"><span class="annot"><span class="annottext">ServiceId -&gt; ServiceId -&gt; Bool
(ServiceId -&gt; ServiceId -&gt; Bool)
-&gt; (ServiceId -&gt; ServiceId -&gt; Bool) -&gt; Eq ServiceId
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ServiceId -&gt; ServiceId -&gt; Bool
$c/= :: ServiceId -&gt; ServiceId -&gt; Bool
== :: ServiceId -&gt; ServiceId -&gt; Bool
$c== :: ServiceId -&gt; ServiceId -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159216"><span id="local-6989586621679159218"><span id="local-6989586621679159220"><span class="annot"><span class="annottext">Int -&gt; ServiceId -&gt; ShowS
[ServiceId] -&gt; ShowS
ServiceId -&gt; String
(Int -&gt; ServiceId -&gt; ShowS)
-&gt; (ServiceId -&gt; String)
-&gt; ([ServiceId] -&gt; ShowS)
-&gt; Show ServiceId
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ServiceId] -&gt; ShowS
$cshowList :: [ServiceId] -&gt; ShowS
show :: ServiceId -&gt; String
$cshow :: ServiceId -&gt; String
showsPrec :: Int -&gt; ServiceId -&gt; ShowS
$cshowsPrec :: Int -&gt; ServiceId -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ServiceId -&gt; Rep ServiceId x)
-&gt; (forall x. Rep ServiceId x -&gt; ServiceId) -&gt; Generic ServiceId
forall x. Rep ServiceId x -&gt; ServiceId
forall x. ServiceId -&gt; Rep ServiceId x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ServiceId x -&gt; ServiceId
$cfrom :: forall x. ServiceId -&gt; Rep ServiceId x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159206"><span id="local-6989586621679159208"><span id="local-6989586621679159210"><span class="annot"><span class="annottext">Get ServiceId
[ServiceId] -&gt; Put
ServiceId -&gt; Put
(ServiceId -&gt; Put)
-&gt; Get ServiceId -&gt; ([ServiceId] -&gt; Put) -&gt; Binary ServiceId
forall t. (t -&gt; Put) -&gt; Get t -&gt; ([t] -&gt; Put) -&gt; Binary t
putList :: [ServiceId] -&gt; Put
$cputList :: [ServiceId] -&gt; Put
get :: Get ServiceId
$cget :: Get ServiceId
put :: ServiceId -&gt; Put
$cput :: ServiceId -&gt; Put
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Binary</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Hyperion.Remote.html#serviceIdToText"><span class="hs-identifier hs-type">serviceIdToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-59"></span><span id="serviceIdToText"><span class="annot"><span class="annottext">serviceIdToText :: ServiceId -&gt; Text
</span><a href="Hyperion.Remote.html#serviceIdToText"><span class="hs-identifier hs-var hs-var">serviceIdToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (ServiceId -&gt; String) -&gt; ServiceId -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; String
</span><a href="Hyperion.Remote.html#serviceIdToString"><span class="hs-identifier hs-var">serviceIdToString</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Hyperion.Remote.html#serviceIdToString"><span class="hs-identifier hs-type">serviceIdToString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-62"></span><span id="serviceIdToString"><span class="annot"><span class="annottext">serviceIdToString :: ServiceId -&gt; String
</span><a href="Hyperion.Remote.html#serviceIdToString"><span class="hs-identifier hs-var hs-var">serviceIdToString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span id="local-6989586621679159201"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159201"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159201"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Type for basic master to worker messaging</span><span>
</span><span id="line-65"></span><span id="local-6989586621679159199"><span id="local-6989586621679159200"></span></span><span class="hs-keyword">data</span><span> </span><span id="WorkerMessage"><span class="annot"><a href="Hyperion.Remote.html#WorkerMessage"><span class="hs-identifier hs-var">WorkerMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Connected"><span class="annot"><a href="Hyperion.Remote.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ShutDown"><span class="annot"><a href="Hyperion.Remote.html#ShutDown"><span class="hs-identifier hs-var">ShutDown</span></a></span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159189"><span id="local-6989586621679159191"><span id="local-6989586621679159193"><span id="local-6989586621679159195"><span class="annot"><span class="annottext">ReadPrec [WorkerMessage]
ReadPrec WorkerMessage
Int -&gt; ReadS WorkerMessage
ReadS [WorkerMessage]
(Int -&gt; ReadS WorkerMessage)
-&gt; ReadS [WorkerMessage]
-&gt; ReadPrec WorkerMessage
-&gt; ReadPrec [WorkerMessage]
-&gt; Read WorkerMessage
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [WorkerMessage]
$creadListPrec :: ReadPrec [WorkerMessage]
readPrec :: ReadPrec WorkerMessage
$creadPrec :: ReadPrec WorkerMessage
readList :: ReadS [WorkerMessage]
$creadList :: ReadS [WorkerMessage]
readsPrec :: Int -&gt; ReadS WorkerMessage
$creadsPrec :: Int -&gt; ReadS WorkerMessage
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159182"><span id="local-6989586621679159184"><span id="local-6989586621679159186"><span class="annot"><span class="annottext">Int -&gt; WorkerMessage -&gt; ShowS
[WorkerMessage] -&gt; ShowS
WorkerMessage -&gt; String
(Int -&gt; WorkerMessage -&gt; ShowS)
-&gt; (WorkerMessage -&gt; String)
-&gt; ([WorkerMessage] -&gt; ShowS)
-&gt; Show WorkerMessage
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WorkerMessage] -&gt; ShowS
$cshowList :: [WorkerMessage] -&gt; ShowS
show :: WorkerMessage -&gt; String
$cshow :: WorkerMessage -&gt; String
showsPrec :: Int -&gt; WorkerMessage -&gt; ShowS
$cshowsPrec :: Int -&gt; WorkerMessage -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. WorkerMessage -&gt; Rep WorkerMessage x)
-&gt; (forall x. Rep WorkerMessage x -&gt; WorkerMessage)
-&gt; Generic WorkerMessage
forall x. Rep WorkerMessage x -&gt; WorkerMessage
forall x. WorkerMessage -&gt; Rep WorkerMessage x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep WorkerMessage x -&gt; WorkerMessage
$cfrom :: forall x. WorkerMessage -&gt; Rep WorkerMessage x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159174"><span id="local-6989586621679159176"><span id="local-6989586621679159178"><span class="annot"><span class="annottext">Get WorkerMessage
[WorkerMessage] -&gt; Put
WorkerMessage -&gt; Put
(WorkerMessage -&gt; Put)
-&gt; Get WorkerMessage
-&gt; ([WorkerMessage] -&gt; Put)
-&gt; Binary WorkerMessage
forall t. (t -&gt; Put) -&gt; Get t -&gt; ([t] -&gt; Put) -&gt; Binary t
putList :: [WorkerMessage] -&gt; Put
$cputList :: [WorkerMessage] -&gt; Put
get :: Get WorkerMessage
$cget :: Get WorkerMessage
put :: WorkerMessage -&gt; Put
$cput :: WorkerMessage -&gt; Put
</span><a href="#local-6989586621679159174"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Binary</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">data</span><span> </span><span id="RemoteError"><span class="annot"><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RemoteError"><span class="annot"><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#RemoteErrorType"><span class="hs-identifier hs-type">RemoteErrorType</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159167"><span id="local-6989586621679159169"><span id="local-6989586621679159171"><span class="annot"><span class="annottext">Int -&gt; RemoteError -&gt; ShowS
[RemoteError] -&gt; ShowS
RemoteError -&gt; String
(Int -&gt; RemoteError -&gt; ShowS)
-&gt; (RemoteError -&gt; String)
-&gt; ([RemoteError] -&gt; ShowS)
-&gt; Show RemoteError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RemoteError] -&gt; ShowS
$cshowList :: [RemoteError] -&gt; ShowS
show :: RemoteError -&gt; String
$cshow :: RemoteError -&gt; String
showsPrec :: Int -&gt; RemoteError -&gt; ShowS
$cshowsPrec :: Int -&gt; RemoteError -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159159"><span id="local-6989586621679159161"><span id="local-6989586621679159163"><span class="annot"><span class="annottext">Show RemoteError
Typeable RemoteError
Typeable RemoteError
-&gt; Show RemoteError
-&gt; (RemoteError -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe RemoteError)
-&gt; (RemoteError -&gt; String)
-&gt; Exception RemoteError
SomeException -&gt; Maybe RemoteError
RemoteError -&gt; String
RemoteError -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; Exception e
displayException :: RemoteError -&gt; String
$cdisplayException :: RemoteError -&gt; String
fromException :: SomeException -&gt; Maybe RemoteError
$cfromException :: SomeException -&gt; Maybe RemoteError
toException :: RemoteError -&gt; SomeException
$ctoException :: RemoteError -&gt; SomeException
$cp2Exception :: Show RemoteError
$cp1Exception :: Typeable RemoteError
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Detailed type for 'RemoteError'. The constructors correspond to various</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- possible 'AsyncResult's.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="RemoteErrorType"><span class="annot"><a href="Hyperion.Remote.html#RemoteErrorType"><span class="hs-identifier hs-var">RemoteErrorType</span></a></span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RemoteAsyncFailed"><span class="annot"><a href="Hyperion.Remote.html#RemoteAsyncFailed"><span class="hs-identifier hs-var">RemoteAsyncFailed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiedReason</span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RemoteAsyncLinkFailed"><span class="annot"><a href="Hyperion.Remote.html#RemoteAsyncLinkFailed"><span class="hs-identifier hs-var">RemoteAsyncLinkFailed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiedReason</span></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RemoteAsyncCancelled"><span class="annot"><a href="Hyperion.Remote.html#RemoteAsyncCancelled"><span class="hs-identifier hs-var">RemoteAsyncCancelled</span></a></span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RemoteAsyncPending"><span class="annot"><a href="Hyperion.Remote.html#RemoteAsyncPending"><span class="hs-identifier hs-var">RemoteAsyncPending</span></a></span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RemoteException"><span class="annot"><a href="Hyperion.Remote.html#RemoteException"><span class="hs-identifier hs-var">RemoteException</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159147"><span id="local-6989586621679159149"><span id="local-6989586621679159151"><span class="annot"><span class="annottext">Int -&gt; RemoteErrorType -&gt; ShowS
[RemoteErrorType] -&gt; ShowS
RemoteErrorType -&gt; String
(Int -&gt; RemoteErrorType -&gt; ShowS)
-&gt; (RemoteErrorType -&gt; String)
-&gt; ([RemoteErrorType] -&gt; ShowS)
-&gt; Show RemoteErrorType
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RemoteErrorType] -&gt; ShowS
$cshowList :: [RemoteErrorType] -&gt; ShowS
show :: RemoteErrorType -&gt; String
$cshow :: RemoteErrorType -&gt; String
showsPrec :: Int -&gt; RemoteErrorType -&gt; ShowS
$cshowsPrec :: Int -&gt; RemoteErrorType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="WorkerConnectionTimeout"><span class="annot"><a href="Hyperion.Remote.html#WorkerConnectionTimeout"><span class="hs-identifier hs-var">WorkerConnectionTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkerConnectionTimeout"><span class="annot"><a href="Hyperion.Remote.html#WorkerConnectionTimeout"><span class="hs-identifier hs-var">WorkerConnectionTimeout</span></a></span></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159140"><span id="local-6989586621679159142"><span id="local-6989586621679159144"><span class="annot"><span class="annottext">Int -&gt; WorkerConnectionTimeout -&gt; ShowS
[WorkerConnectionTimeout] -&gt; ShowS
WorkerConnectionTimeout -&gt; String
(Int -&gt; WorkerConnectionTimeout -&gt; ShowS)
-&gt; (WorkerConnectionTimeout -&gt; String)
-&gt; ([WorkerConnectionTimeout] -&gt; ShowS)
-&gt; Show WorkerConnectionTimeout
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WorkerConnectionTimeout] -&gt; ShowS
$cshowList :: [WorkerConnectionTimeout] -&gt; ShowS
show :: WorkerConnectionTimeout -&gt; String
$cshow :: WorkerConnectionTimeout -&gt; String
showsPrec :: Int -&gt; WorkerConnectionTimeout -&gt; ShowS
$cshowsPrec :: Int -&gt; WorkerConnectionTimeout -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159132"><span id="local-6989586621679159134"><span id="local-6989586621679159136"><span class="annot"><span class="annottext">Show WorkerConnectionTimeout
Typeable WorkerConnectionTimeout
Typeable WorkerConnectionTimeout
-&gt; Show WorkerConnectionTimeout
-&gt; (WorkerConnectionTimeout -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe WorkerConnectionTimeout)
-&gt; (WorkerConnectionTimeout -&gt; String)
-&gt; Exception WorkerConnectionTimeout
SomeException -&gt; Maybe WorkerConnectionTimeout
WorkerConnectionTimeout -&gt; String
WorkerConnectionTimeout -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; Exception e
displayException :: WorkerConnectionTimeout -&gt; String
$cdisplayException :: WorkerConnectionTimeout -&gt; String
fromException :: SomeException -&gt; Maybe WorkerConnectionTimeout
$cfromException :: SomeException -&gt; Maybe WorkerConnectionTimeout
toException :: WorkerConnectionTimeout -&gt; SomeException
$ctoException :: WorkerConnectionTimeout -&gt; SomeException
$cp2Exception :: Show WorkerConnectionTimeout
$cp1Exception :: Typeable WorkerConnectionTimeout
</span><a href="#local-6989586621679159132"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | 'WorkerLauncher' type parametrized by a type for job id.</span><span>
</span><span id="line-85"></span><span class="hs-keyword">data</span><span> </span><span id="WorkerLauncher"><span class="annot"><a href="Hyperion.Remote.html#WorkerLauncher"><span class="hs-identifier hs-var">WorkerLauncher</span></a></span></span><span> </span><span id="local-6989586621679159322"><span class="annot"><a href="#local-6989586621679159322"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkerLauncher"><span class="annot"><a href="Hyperion.Remote.html#WorkerLauncher"><span class="hs-identifier hs-var">WorkerLauncher</span></a></span></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | A function that launches a worker for the given 'ServiceId' on</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- the master 'NodeId' and supplies its job id to the given</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- continuation</span><span>
</span><span id="line-89"></span><span>    </span><span id="withLaunchedWorker"><span class="annot"><span class="annottext">WorkerLauncher j
-&gt; forall b. NodeId -&gt; ServiceId -&gt; (j -&gt; Process b) -&gt; Process b
</span><a href="Hyperion.Remote.html#withLaunchedWorker"><span class="hs-identifier hs-var hs-var">withLaunchedWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679159408"><span class="annot"><a href="#local-6989586621679159408"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679159322"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159408"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159408"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- | Timeout for the worker to connect. If the worker is launched</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">-- into a Slurm queue, it may take a very long time to connect. In</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- that case, it is recommended to set 'connectionTimeout' =</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- 'Nothing'.</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="connectionTimeout"><span class="annot"><span class="annottext">WorkerLauncher j -&gt; Maybe NominalDiffTime
</span><a href="Hyperion.Remote.html#connectionTimeout"><span class="hs-identifier hs-var hs-var">connectionTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-comment">-- | A handler for 'RemoteError's.  'onRemoteError' can do things</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-comment">-- like blocking before rerunning the remote process, or simply</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- rethrowing the error.</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="onRemoteError"><span class="annot"><span class="annottext">WorkerLauncher j -&gt; forall b. RemoteError -&gt; Process b -&gt; Process b
</span><a href="Hyperion.Remote.html#onRemoteError"><span class="hs-identifier hs-var hs-var">onRemoteError</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679159403"><span class="annot"><a href="#local-6989586621679159403"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-type">RemoteError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159403"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159403"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- * Functions for running a worker</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Run a Process locally using the default</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- 'RemoteTable'. Additionally allows a return value for the</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- 'Process'.</span><span>
</span><span id="line-106"></span><span id="local-6989586621679159127"><span class="annot"><a href="Hyperion.Remote.html#runProcessLocal"><span class="hs-identifier hs-type">runProcessLocal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679159127"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-107"></span><span id="runProcessLocal"><span class="annot"><span class="annottext">runProcessLocal :: Process a -&gt; IO a
</span><a href="Hyperion.Remote.html#runProcessLocal"><span class="hs-identifier hs-var hs-var">runProcessLocal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteTable -&gt; Process a -&gt; IO a
forall a. RemoteTable -&gt; Process a -&gt; IO a
</span><a href="Hyperion.Remote.html#runProcessLocalWithRT"><span class="hs-identifier hs-var">runProcessLocalWithRT</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteTable
</span><span class="hs-identifier hs-var">Node.initRemoteTable</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Run a Process locally using the specified</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- 'RemoteTable'. Additionally allows a return value for the</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- 'Process'.</span><span>
</span><span id="line-112"></span><span id="local-6989586621679159400"><span class="annot"><a href="Hyperion.Remote.html#runProcessLocalWithRT"><span class="hs-identifier hs-type">runProcessLocalWithRT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteTable</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159400"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679159400"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-113"></span><span id="runProcessLocalWithRT"><span class="annot"><span class="annottext">runProcessLocalWithRT :: RemoteTable -&gt; Process a -&gt; IO a
</span><a href="Hyperion.Remote.html#runProcessLocalWithRT"><span class="hs-identifier hs-var hs-var">runProcessLocalWithRT</span></a></span></span><span> </span><span id="local-6989586621679159123"><span class="annot"><span class="annottext">RemoteTable
</span><a href="#local-6989586621679159123"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679159122"><span class="annot"><span class="annottext">Process a
</span><a href="#local-6989586621679159122"><span class="hs-identifier hs-var">process</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679159121"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679159121"><span class="hs-identifier hs-var">resultVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar a)
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="annottext">RemoteTable -&gt; Process () -&gt; IO ()
</span><a href="Hyperion.Remote.html#runProcessLocalWithRT_"><span class="hs-identifier hs-var">runProcessLocalWithRT_</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteTable
</span><a href="#local-6989586621679159123"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">(Process () -&gt; IO ()) -&gt; Process () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Process a
</span><a href="#local-6989586621679159122"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">Process a -&gt; (a -&gt; Process ()) -&gt; Process ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Process ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Process ()) -&gt; (a -&gt; IO ()) -&gt; a -&gt; Process ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679159121"><span class="hs-identifier hs-var">resultVar</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">MVar a -&gt; IO a
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679159121"><span class="hs-identifier hs-var">resultVar</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Spawns a new local &quot;Control.Distributed.Process.Node&quot; and runs</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- the given 'Process' on it. Waits for the process to finish.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Binds to the first available port by specifying port 0.</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Hyperion.Remote.html#runProcessLocalWithRT_"><span class="hs-identifier hs-type">runProcessLocalWithRT_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteTable</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span id="runProcessLocalWithRT_"><span class="annot"><span class="annottext">runProcessLocalWithRT_ :: RemoteTable -&gt; Process () -&gt; IO ()
</span><a href="Hyperion.Remote.html#runProcessLocalWithRT_"><span class="hs-identifier hs-var hs-var">runProcessLocalWithRT_</span></a></span></span><span> </span><span id="local-6989586621679159118"><span class="annot"><span class="annottext">RemoteTable
</span><a href="#local-6989586621679159118"><span class="hs-identifier hs-var">rtable</span></a></span></span><span> </span><span id="local-6989586621679159117"><span class="annot"><span class="annottext">Process ()
</span><a href="#local-6989586621679159117"><span class="hs-identifier hs-var">process</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-comment">-- This doesn't work on expanse. Comment this line out on expanse:</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679159116"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159116"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getHostName</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-comment">-- This does work on expanse, but not anywhere else. Uncomment this</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-comment">-- line on expanse:</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-comment">--host &lt;- getExternalHostName</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="annottext">TCPAddr -&gt; TCPParameters -&gt; IO (Either IOException Transport)
</span><span class="hs-identifier hs-var">NT.createTransport</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; TCPAddr
</span><span class="hs-identifier hs-var">NT.defaultTCPAddr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159116"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCPParameters
</span><span class="hs-identifier hs-var">NT.defaultTCPParameters</span></span><span> </span><span class="annot"><span class="annottext">IO (Either IOException Transport)
-&gt; (Either IOException Transport -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679159112"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679159112"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadThrow m, MonadIO m, Exception e) =&gt;
e -&gt; m a
</span><a href="Hyperion.Log.html#throw"><span class="hs-identifier hs-var">Log.throw</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679159112"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679159110"><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679159110"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621679159109"><span class="annot"><span class="annottext">LocalNode
</span><a href="#local-6989586621679159109"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transport -&gt; RemoteTable -&gt; IO LocalNode
</span><span class="hs-identifier hs-var">Node.newLocalNode</span></span><span> </span><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679159110"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteTable
</span><a href="#local-6989586621679159118"><span class="hs-identifier hs-var">rtable</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; NodeId -&gt; IO ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Running on node&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalNode -&gt; NodeId
</span><span class="hs-identifier hs-var hs-var">Node.localNodeId</span></span><span> </span><span class="annot"><span class="annottext">LocalNode
</span><a href="#local-6989586621679159109"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">LocalNode -&gt; Process () -&gt; IO ()
</span><span class="hs-identifier hs-var">Node.runProcess</span></span><span> </span><span class="annot"><span class="annottext">LocalNode
</span><a href="#local-6989586621679159109"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">Process ()
</span><a href="#local-6989586621679159117"><span class="hs-identifier hs-var">process</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Get a hostname for the current machine that does not correspond</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- to a local network address (127.* or 10.*)</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Hyperion.Remote.html#getExternalHostName"><span class="hs-identifier hs-type">getExternalHostName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-139"></span><span id="getExternalHostName"><span class="annot"><span class="annottext">getExternalHostName :: IO String
</span><a href="Hyperion.Remote.html#getExternalHostName"><span class="hs-identifier hs-var hs-var">getExternalHostName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-comment">-- TODO: Here 'stayopen' is set to True. Is this an ok choice?</span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621679159103"><span class="annot"><span class="annottext">[HostEntry]
</span><a href="#local-6989586621679159103"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO [HostEntry]
</span><span class="hs-identifier hs-var">getHostEntries</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(HostEntry -&gt; Bool) -&gt; [HostEntry] -&gt; [HostEntry]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HostAddress -&gt; Bool) -&gt; [HostAddress] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (HostAddress -&gt; Bool) -&gt; HostAddress -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; Bool
</span><a href="#local-6989586621679159100"><span class="hs-identifier hs-var">isLocal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([HostAddress] -&gt; Bool)
-&gt; (HostEntry -&gt; [HostAddress]) -&gt; HostEntry -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HostEntry -&gt; [HostAddress]
</span><span class="hs-identifier hs-var hs-var">hostAddresses</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HostEntry]
</span><a href="#local-6989586621679159103"><span class="hs-identifier hs-var">entries</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679159098"><span class="annot"><span class="annottext">HostEntry
</span><a href="#local-6989586621679159098"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HostEntry]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HostEntry -&gt; String
</span><span class="hs-identifier hs-var hs-var">hostName</span></span><span> </span><span class="annot"><span class="annottext">HostEntry
</span><a href="#local-6989586621679159098"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; m a
</span><a href="Hyperion.Log.html#throwError"><span class="hs-identifier hs-var">Log.throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot find external network address among host entries: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[HostEntry] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[HostEntry]
</span><a href="#local-6989586621679159103"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679159100"><span class="annot"><span class="annottext">isLocal :: HostAddress -&gt; Bool
</span><a href="#local-6989586621679159100"><span class="hs-identifier hs-var hs-var">isLocal</span></a></span></span><span> </span><span id="local-6989586621679159094"><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679159094"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; (Word8, Word8, Word8, Word8)
</span><span class="hs-identifier hs-var">hostAddressToTuple</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679159094"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">127</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">(Word8, Word8, Word8, Word8)
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | Convert a 'Text' representation of 'EndPointAddress' to 'NodeId'.</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- The format for the end point address is \&quot;TCP host:TCP port:endpoint id\&quot;</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Hyperion.Remote.html#addressToNodeId"><span class="hs-identifier hs-type">addressToNodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span>
</span><span id="line-154"></span><span id="addressToNodeId"><span class="annot"><span class="annottext">addressToNodeId :: Text -&gt; NodeId
</span><a href="Hyperion.Remote.html#addressToNodeId"><span class="hs-identifier hs-var hs-var">addressToNodeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndPointAddress -&gt; NodeId
</span><span class="hs-identifier hs-var">NodeId</span></span><span> </span><span class="annot"><span class="annottext">(EndPointAddress -&gt; NodeId)
-&gt; (Text -&gt; EndPointAddress) -&gt; Text -&gt; NodeId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; EndPointAddress
</span><span class="hs-identifier hs-var">EndPointAddress</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; EndPointAddress)
-&gt; (Text -&gt; ByteString) -&gt; Text -&gt; EndPointAddress
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">E.encodeUtf8</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Inverse to 'addressToNodeId'</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Hyperion.Remote.html#nodeIdToAddress"><span class="hs-identifier hs-type">nodeIdToAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-158"></span><span id="nodeIdToAddress"><span class="annot"><span class="annottext">nodeIdToAddress :: NodeId -&gt; Text
</span><a href="Hyperion.Remote.html#nodeIdToAddress"><span class="hs-identifier hs-var hs-var">nodeIdToAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EndPointAddress</span></span><span> </span><span id="local-6989586621679159088"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679159088"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">E.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679159088"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Hyperion.Remote.html#masterNodeIdLabel"><span class="hs-identifier hs-type">masterNodeIdLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-161"></span><span id="masterNodeIdLabel"><span class="annot"><span class="annottext">masterNodeIdLabel :: String
</span><a href="Hyperion.Remote.html#masterNodeIdLabel"><span class="hs-identifier hs-var hs-var">masterNodeIdLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;masterNodeIdLabel&quot;</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Hyperion.Remote.html#masterNodeIdStatic"><span class="hs-identifier hs-type">masterNodeIdStatic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Static</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span id="masterNodeIdStatic"><span class="annot"><span class="annottext">masterNodeIdStatic :: Static (Maybe NodeId)
</span><a href="Hyperion.Remote.html#masterNodeIdStatic"><span class="hs-identifier hs-var hs-var">masterNodeIdStatic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Static (Maybe NodeId)
forall a. String -&gt; Static a
</span><span class="hs-identifier hs-var">staticLabel</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Hyperion.Remote.html#masterNodeIdLabel"><span class="hs-identifier hs-var">masterNodeIdLabel</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Hyperion.Remote.html#getMasterNodeId"><span class="hs-identifier hs-type">getMasterNodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="getMasterNodeId"><span class="annot"><span class="annottext">getMasterNodeId :: Process (Maybe NodeId)
</span><a href="Hyperion.Remote.html#getMasterNodeId"><span class="hs-identifier hs-var hs-var">getMasterNodeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Static (Maybe NodeId) -&gt; Process (Maybe NodeId)
forall a. Typeable a =&gt; Static a -&gt; Process a
</span><span class="hs-identifier hs-var">unStatic</span></span><span> </span><span class="annot"><span class="annottext">Static (Maybe NodeId)
</span><a href="Hyperion.Remote.html#masterNodeIdStatic"><span class="hs-identifier hs-var">masterNodeIdStatic</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Hyperion.Remote.html#registerMasterNodeId"><span class="hs-identifier hs-type">registerMasterNodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteTable</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteTable</span></span><span>
</span><span id="line-170"></span><span id="registerMasterNodeId"><span class="annot"><span class="annottext">registerMasterNodeId :: Maybe NodeId -&gt; RemoteTable -&gt; RemoteTable
</span><a href="Hyperion.Remote.html#registerMasterNodeId"><span class="hs-identifier hs-var hs-var">registerMasterNodeId</span></a></span></span><span> </span><span id="local-6989586621679159081"><span class="annot"><span class="annottext">Maybe NodeId
</span><a href="#local-6989586621679159081"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Dynamic -&gt; RemoteTable -&gt; RemoteTable
</span><span class="hs-identifier hs-var">registerStatic</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Hyperion.Remote.html#masterNodeIdLabel"><span class="hs-identifier hs-var">masterNodeIdLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe NodeId -&gt; Dynamic
forall a. Typeable a =&gt; a -&gt; Dynamic
</span><span class="hs-identifier hs-var">toDynamic</span></span><span> </span><span class="annot"><span class="annottext">Maybe NodeId
</span><a href="#local-6989586621679159081"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Hyperion.Remote.html#initWorkerRemoteTable"><span class="hs-identifier hs-type">initWorkerRemoteTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteTable</span></span><span>
</span><span id="line-173"></span><span id="initWorkerRemoteTable"><span class="annot"><span class="annottext">initWorkerRemoteTable :: Maybe NodeId -&gt; RemoteTable
</span><a href="Hyperion.Remote.html#initWorkerRemoteTable"><span class="hs-identifier hs-var hs-var">initWorkerRemoteTable</span></a></span></span><span> </span><span id="local-6989586621679159079"><span class="annot"><span class="annottext">Maybe NodeId
</span><a href="#local-6989586621679159079"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NodeId -&gt; RemoteTable -&gt; RemoteTable
</span><a href="Hyperion.Remote.html#registerMasterNodeId"><span class="hs-identifier hs-var">registerMasterNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NodeId
</span><a href="#local-6989586621679159079"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteTable
</span><span class="hs-identifier hs-var">Node.initRemoteTable</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | The main worker process.</span><span>
</span><span id="line-176"></span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- Repeatedly (at most 5 times) send our own 'ProcessId' and the send end of a typed channel</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- ('SendPort' 'WorkerMessage') to a master node until it replies</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- 'Connected' (timeout 10 seconds for each attempt).</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- Then 'expect' a 'ShutDown' signal.</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- While waiting, other processes will be run in a different thread,</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- invoked by master through our 'NodeId' (which it extracts from 'ProcessId')</span><span>
</span><span id="line-184"></span><span class="annot"><a href="Hyperion.Remote.html#worker"><span class="hs-identifier hs-type">worker</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span>     </span><span class="hs-comment">-- ^ 'NodeId' of the master node</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span>  </span><span class="hs-comment">-- ^ 'ServiceId' of master 'Process' (should be 'register'ed)</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span id="worker"><span class="annot"><span class="annottext">worker :: NodeId -&gt; ServiceId -&gt; Process ()
</span><a href="Hyperion.Remote.html#worker"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679159077"><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159077"><span class="hs-identifier hs-var">masterNode</span></a></span></span><span> </span><span id="local-6989586621679159076"><span class="annot"><span class="annottext">serviceId :: ServiceId
</span><a href="#local-6989586621679159076"><span class="hs-identifier hs-var">serviceId</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span id="local-6989586621679159075"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159075"><span class="hs-identifier hs-var">masterService</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679159074"><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159074"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Process ProcessId
</span><span class="hs-identifier hs-var">getSelfPid</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679159072"><span class="annot"><span class="annottext">SendPort WorkerMessage
</span><a href="#local-6989586621679159072"><span class="hs-identifier hs-var">sendPort</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159071"><span class="annot"><span class="annottext">ReceivePort WorkerMessage
</span><a href="#local-6989586621679159071"><span class="hs-identifier hs-var">receivePort</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Process (SendPort WorkerMessage, ReceivePort WorkerMessage)
forall a. Serializable a =&gt; Process (SendPort a, ReceivePort a)
</span><span class="hs-identifier hs-var">newChan</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679159069"><span class="annot"><span class="annottext">connectToMaster :: MaybeT Process WorkerMessage
</span><a href="#local-6989586621679159069"><span class="hs-identifier hs-var hs-var">connectToMaster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process (Maybe WorkerMessage) -&gt; MaybeT Process WorkerMessage
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(Process (Maybe WorkerMessage) -&gt; MaybeT Process WorkerMessage)
-&gt; Process (Maybe WorkerMessage) -&gt; MaybeT Process WorkerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; NodeId -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Connecting to master&quot;</span></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159077"><span class="hs-identifier hs-var">masterNode</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">NodeId
-&gt; String
-&gt; (ProcessId, ServiceId, SendPort WorkerMessage)
-&gt; Process ()
forall a. Serializable a =&gt; NodeId -&gt; String -&gt; a -&gt; Process ()
</span><span class="hs-identifier hs-var">nsendRemote</span></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159077"><span class="hs-identifier hs-var">masterNode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159075"><span class="hs-identifier hs-var">masterService</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159074"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159076"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SendPort WorkerMessage
</span><a href="#local-6989586621679159072"><span class="hs-identifier hs-var">sendPort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; ReceivePort WorkerMessage -&gt; Process (Maybe WorkerMessage)
forall a.
Serializable a =&gt;
Int -&gt; ReceivePort a -&gt; Process (Maybe a)
</span><span class="hs-identifier hs-var">receiveChanTimeout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReceivePort WorkerMessage
</span><a href="#local-6989586621679159071"><span class="hs-identifier hs-var">receivePort</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">MaybeT Process WorkerMessage -&gt; Process (Maybe WorkerMessage)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var hs-var">runMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MaybeT Process WorkerMessage] -&gt; MaybeT Process WorkerMessage
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; MaybeT Process WorkerMessage -&gt; [MaybeT Process WorkerMessage]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">MaybeT Process WorkerMessage
</span><a href="#local-6989586621679159069"><span class="hs-identifier hs-var">connectToMaster</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Process (Maybe WorkerMessage)
-&gt; (Maybe WorkerMessage -&gt; Process ()) -&gt; Process ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">WorkerMessage
</span><a href="Hyperion.Remote.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Process ()
forall (m :: * -&gt; *). MonadIO m =&gt; Text -&gt; m ()
</span><a href="Hyperion.Log.html#text"><span class="hs-identifier hs-var">Log.text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Successfully connected to master.&quot;</span></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">Process WorkerMessage
forall a. Serializable a =&gt; Process a
</span><span class="hs-identifier hs-var">expect</span></span><span> </span><span class="annot"><span class="annottext">Process WorkerMessage
-&gt; (WorkerMessage -&gt; Process ()) -&gt; Process ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">WorkerMessage
</span><a href="Hyperion.Remote.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Process ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; m a
</span><a href="Hyperion.Log.html#throwError"><span class="hs-identifier hs-var">Log.throwError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected 'Connected' received.&quot;</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">WorkerMessage
</span><a href="Hyperion.Remote.html#ShutDown"><span class="hs-identifier hs-var">ShutDown</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Process ()
forall (m :: * -&gt; *). MonadIO m =&gt; Text -&gt; m ()
</span><a href="Hyperion.Log.html#text"><span class="hs-identifier hs-var">Log.text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Shutting down.&quot;</span></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">Maybe WorkerMessage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Process ()
forall (m :: * -&gt; *). MonadIO m =&gt; Text -&gt; m ()
</span><a href="Hyperion.Log.html#text"><span class="hs-identifier hs-var">Log.text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Couldn't connect to master&quot;</span></span><span> </span><span class="annot"><span class="annottext">Process () -&gt; Process () -&gt; Process ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Process ()
forall a b. Serializable a =&gt; a -&gt; Process b
</span><span class="hs-identifier hs-var">die</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Registers ('register') the current process under a random 'ServiceId', then</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- passes the 'ServiceId' to the given continuation.</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- After the continuation returns, unregisters ('unregister') the 'ServiceId'.</span><span>
</span><span id="line-208"></span><span id="local-6989586621679159321"><span class="annot"><a href="Hyperion.Remote.html#withServiceId"><span class="hs-identifier hs-type">withServiceId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159321"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159321"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-209"></span><span id="withServiceId"><span class="annot"><span class="annottext">withServiceId :: (ServiceId -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withServiceId"><span class="hs-identifier hs-var hs-var">withServiceId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process ServiceId
-&gt; (ServiceId -&gt; Process ())
-&gt; (ServiceId -&gt; Process a)
-&gt; Process a
forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">Process ServiceId
</span><a href="#local-6989586621679159058"><span class="hs-identifier hs-var">newServiceId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span id="local-6989586621679159057"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159057"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Process ()
</span><span class="hs-identifier hs-var">unregister</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159057"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679159058"><span class="annot"><span class="annottext">newServiceId :: Process ServiceId
</span><a href="#local-6989586621679159058"><span class="hs-identifier hs-var hs-var">newServiceId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>      </span><span id="local-6989586621679159055"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159055"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; Process String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; Process String) -&gt; IO String -&gt; Process String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Unique -&gt; String) -&gt; IO Unique -&gt; IO String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO Unique
</span><a href="Hyperion.Util.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Process ProcessId
</span><span class="hs-identifier hs-var">getSelfPid</span></span><span> </span><span class="annot"><span class="annottext">Process ProcessId -&gt; (ProcessId -&gt; Process ()) -&gt; Process ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ProcessId -&gt; Process ()
</span><span class="hs-identifier hs-var">register</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159055"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">ServiceId -&gt; Process ServiceId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ServiceId
</span><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-var">ServiceId</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159055"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Start a new remote worker using 'WorkerLauncher' and call a continuation</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- with the 'NodeId' and 'ServiceId' of that worker. The continuation is</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- run in the process that is registered under the 'ServiceId' (see 'withServiceId').</span><span>
</span><span id="line-219"></span><span class="hs-comment">--</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- Throws ('throwM') a 'WorkerConnectionTimeout' if worker times out (timeout</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- described in 'WorkerLauncher')</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- The call to the user function is 'bracket'ed by worker startup and shutdown</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- procedures.</span><span>
</span><span id="line-225"></span><span id="local-6989586621679159293"><span id="local-6989586621679159294"><span class="annot"><a href="Hyperion.Remote.html#withService"><span class="hs-identifier hs-type">withService</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679159294"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#WorkerLauncher"><span class="hs-identifier hs-type">WorkerLauncher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159294"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159293"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159293"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-230"></span><span id="withService"><span class="annot"><span class="annottext">withService :: WorkerLauncher j -&gt; (NodeId -&gt; ServiceId -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withService"><span class="hs-identifier hs-var hs-var">withService</span></a></span></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#WorkerLauncher"><span class="hs-identifier hs-type">WorkerLauncher</span></a></span><span class="hs-special">{</span><span id="local-6989586621679159049"><span id="local-6989586621679159050"><span id="local-6989586621679159051"><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall b. NodeId -&gt; ServiceId -&gt; (j -&gt; Process b) -&gt; Process b
forall b. RemoteError -&gt; Process b -&gt; Process b
onRemoteError :: forall b. RemoteError -&gt; Process b -&gt; Process b
connectionTimeout :: Maybe NominalDiffTime
withLaunchedWorker :: forall b. NodeId -&gt; ServiceId -&gt; (j -&gt; Process b) -&gt; Process b
onRemoteError :: forall j.
WorkerLauncher j -&gt; forall b. RemoteError -&gt; Process b -&gt; Process b
connectionTimeout :: forall j. WorkerLauncher j -&gt; Maybe NominalDiffTime
withLaunchedWorker :: forall j.
WorkerLauncher j
-&gt; forall b. NodeId -&gt; ServiceId -&gt; (j -&gt; Process b) -&gt; Process b
</span><a href="#local-6989586621679159049"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679159048"><span class="annot"><span class="annottext">NodeId -&gt; ServiceId -&gt; Process a
</span><a href="#local-6989586621679159048"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ServiceId -&gt; Process a) -&gt; Process a
forall a. (ServiceId -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withServiceId"><span class="hs-identifier hs-var">withServiceId</span></a></span><span> </span><span class="annot"><span class="annottext">((ServiceId -&gt; Process a) -&gt; Process a)
-&gt; (ServiceId -&gt; Process a) -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679159047"><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621679159046"><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159046"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Process NodeId
</span><span class="hs-identifier hs-var">getSelfNode</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-comment">-- fire up a remote worker with instructions to contact this node</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">NodeId -&gt; ServiceId -&gt; (j -&gt; Process a) -&gt; Process a
forall b. NodeId -&gt; ServiceId -&gt; (j -&gt; Process b) -&gt; Process b
</span><a href="#local-6989586621679159051"><span class="hs-identifier hs-var">withLaunchedWorker</span></a></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159046"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">((j -&gt; Process a) -&gt; Process a) -&gt; (j -&gt; Process a) -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679159044"><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679159044"><span class="hs-identifier hs-var">jobId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; (ServiceId, j) -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Deployed worker&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679159044"><span class="hs-identifier hs-var">jobId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- Wait for the worker to connect and send its id</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-237"></span><span>      </span><span id="local-6989586621679159043"><span class="annot"><span class="annottext">awaitWorker :: Process ProcessId
</span><a href="#local-6989586621679159043"><span class="hs-identifier hs-var hs-var">awaitWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>        </span><span id="local-6989586621679159042"><span class="annot"><span class="annottext">Maybe (ProcessId, ServiceId, SendPort WorkerMessage)
</span><a href="#local-6989586621679159042"><span class="hs-identifier hs-var">connectionResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621679159050"><span class="hs-identifier hs-var">connectionTimeout</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679159041"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679159041"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Process (Maybe (ProcessId, ServiceId, SendPort WorkerMessage))
forall a. Serializable a =&gt; Int -&gt; Process (Maybe a)
</span><span class="hs-identifier hs-var">expectTimeout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Int
</span><a href="Hyperion.Util.html#nominalDiffTimeToMicroseconds"><span class="hs-identifier hs-var">nominalDiffTimeToMicroseconds</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679159041"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((ProcessId, ServiceId, SendPort WorkerMessage)
 -&gt; Maybe (ProcessId, ServiceId, SendPort WorkerMessage))
-&gt; Process (ProcessId, ServiceId, SendPort WorkerMessage)
-&gt; Process (Maybe (ProcessId, ServiceId, SendPort WorkerMessage))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ProcessId, ServiceId, SendPort WorkerMessage)
-&gt; Maybe (ProcessId, ServiceId, SendPort WorkerMessage)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Process (ProcessId, ServiceId, SendPort WorkerMessage)
forall a. Serializable a =&gt; Process a
</span><span class="hs-identifier hs-var">expect</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ProcessId, ServiceId, SendPort WorkerMessage)
</span><a href="#local-6989586621679159042"><span class="hs-identifier hs-var">connectionResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ProcessId, ServiceId, SendPort WorkerMessage)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerConnectionTimeout -&gt; Process ProcessId
forall (m :: * -&gt; *) e a.
(MonadThrow m, MonadIO m, Exception e) =&gt;
e -&gt; m a
</span><a href="Hyperion.Log.html#throw"><span class="hs-identifier hs-var">Log.throw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceId -&gt; WorkerConnectionTimeout
</span><a href="Hyperion.Remote.html#WorkerConnectionTimeout"><span class="hs-identifier hs-var">WorkerConnectionTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159039"><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159039"><span class="hs-identifier hs-var">workerId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProcessId</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159038"><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159038"><span class="hs-identifier hs-var">workerServiceId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SendPort WorkerMessage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SendPort</span></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#WorkerMessage"><span class="hs-identifier hs-type">WorkerMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159038"><span class="hs-identifier hs-var">workerServiceId</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; ServiceId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; (ServiceId, j, ProcessId) -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Ignoring message from unknown worker&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159038"><span class="hs-identifier hs-var">workerServiceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679159044"><span class="hs-identifier hs-var">jobId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159039"><span class="hs-identifier hs-var">workerId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                </span><span class="annot"><span class="annottext">Process ProcessId
</span><a href="#local-6989586621679159043"><span class="hs-identifier hs-var">awaitWorker</span></a></span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159036"><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159036"><span class="hs-identifier hs-var">workerId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProcessId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#ServiceId"><span class="hs-identifier hs-type">ServiceId</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159035"><span class="annot"><span class="annottext">SendPort WorkerMessage
</span><a href="#local-6989586621679159035"><span class="hs-identifier hs-var">replyTo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SendPort</span></span><span> </span><span class="annot"><a href="Hyperion.Remote.html#WorkerMessage"><span class="hs-identifier hs-type">WorkerMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; (ServiceId, j, ProcessId) -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Acquired worker&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679159044"><span class="hs-identifier hs-var">jobId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159036"><span class="hs-identifier hs-var">workerId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                </span><span class="hs-comment">-- Confirm that the worker connected successfully</span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><span class="annottext">SendPort WorkerMessage -&gt; WorkerMessage -&gt; Process ()
forall a. Serializable a =&gt; SendPort a -&gt; a -&gt; Process ()
</span><span class="hs-identifier hs-var">sendChan</span></span><span> </span><span class="annot"><span class="annottext">SendPort WorkerMessage
</span><a href="#local-6989586621679159035"><span class="hs-identifier hs-var">replyTo</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerMessage
</span><a href="Hyperion.Remote.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span>
</span><span id="line-252"></span><span>                </span><span class="annot"><span class="annottext">ProcessId -&gt; Process ProcessId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159036"><span class="hs-identifier hs-var">workerId</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621679159033"><span class="annot"><span class="annottext">shutdownWorker :: ProcessId -&gt; Process ()
</span><a href="#local-6989586621679159033"><span class="hs-identifier hs-var hs-var">shutdownWorker</span></a></span></span><span> </span><span id="local-6989586621679159032"><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159032"><span class="hs-identifier hs-var">workerId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; (ServiceId, j) -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; Text -&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#info"><span class="hs-identifier hs-var">Log.info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Worker finished&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679159044"><span class="hs-identifier hs-var">jobId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">ProcessId -&gt; WorkerMessage -&gt; Process ()
forall a. Serializable a =&gt; ProcessId -&gt; a -&gt; Process ()
</span><span class="hs-identifier hs-var">send</span></span><span> </span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159032"><span class="hs-identifier hs-var">workerId</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerMessage
</span><a href="Hyperion.Remote.html#ShutDown"><span class="hs-identifier hs-var">ShutDown</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">Process ProcessId
-&gt; (ProcessId -&gt; Process ())
-&gt; (ProcessId -&gt; Process a)
-&gt; Process a
forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">Process ProcessId
</span><a href="#local-6989586621679159043"><span class="hs-identifier hs-var">awaitWorker</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessId -&gt; Process ()
</span><a href="#local-6989586621679159033"><span class="hs-identifier hs-var">shutdownWorker</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679159030"><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159030"><span class="hs-identifier hs-var">wId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeId -&gt; ServiceId -&gt; Process a
</span><a href="#local-6989586621679159048"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessId -&gt; NodeId
</span><span class="hs-identifier hs-var hs-var">processNodeId</span></span><span> </span><span class="annot"><span class="annottext">ProcessId
</span><a href="#local-6989586621679159030"><span class="hs-identifier hs-var">wId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159047"><span class="hs-identifier hs-var">serviceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- * Functions related to running remote functions</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | A process that generates the 'Closure' to be run on a remote machine.</span><span>
</span><span id="line-261"></span><span class="hs-keyword">data</span><span> </span><span id="SerializableClosureProcess"><span class="annot"><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-var">SerializableClosureProcess</span></a></span></span><span> </span><span id="local-6989586621679159304"><span class="annot"><a href="#local-6989586621679159304"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SerializableClosureProcess"><span class="annot"><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-var">SerializableClosureProcess</span></a></span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | Process to generate a closure. This process will be run when</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- a remote location has been identified that the closure can be</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- sent to.</span><span>
</span><span id="line-265"></span><span>    </span><span id="runClosureProcess"><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#runClosureProcess"><span class="hs-identifier hs-var hs-var">runClosureProcess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679159304"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-comment">-- | Dict for seralizing the result.</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="staticSDict"><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; Closure (SerializableDict (Either String a))
</span><a href="Hyperion.Remote.html#staticSDict"><span class="hs-identifier hs-var hs-var">staticSDict</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SerializableDict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679159304"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- | If a remote computation fails, it may be added to the 'HoldMap'</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- to be tried again. In that case, we don't want to evaluate</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-comment">-- 'runClosureProcess' again, so we use an 'MVar' to memoize the</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">-- result of 'runClosureProcess'.</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="closureVar"><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#closureVar"><span class="hs-identifier hs-var hs-var">closureVar</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679159304"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- | Get closure and memoize the result</span><span>
</span><span id="line-276"></span><span id="local-6989586621679159024"><span class="annot"><a href="Hyperion.Remote.html#getClosure"><span class="hs-identifier hs-type">getClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-type">SerializableClosureProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159024"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679159024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-277"></span><span id="getClosure"><span class="annot"><span class="annottext">getClosure :: SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#getClosure"><span class="hs-identifier hs-var hs-var">getClosure</span></a></span></span><span> </span><span id="local-6989586621679159022"><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159022"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="annottext">Process Bool -&gt; Process () -&gt; Process ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">whenM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Bool -&gt; Process Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar (Closure (Process (Either String a))) -&gt; IO Bool
forall a. MVar a -&gt; IO Bool
</span><span class="hs-identifier hs-var">isEmptyMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
forall a.
SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#closureVar"><span class="hs-identifier hs-var hs-var">closureVar</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159022"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Process () -&gt; Process ()) -&gt; Process () -&gt; Process ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621679159021"><span class="annot"><span class="annottext">Closure (Process (Either String a))
</span><a href="#local-6989586621679159021"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
forall a.
SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#runClosureProcess"><span class="hs-identifier hs-var hs-var">runClosureProcess</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159022"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Process ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Process ()) -&gt; IO () -&gt; Process ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Closure (Process (Either String a)))
-&gt; Closure (Process (Either String a)) -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
forall a.
SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#closureVar"><span class="hs-identifier hs-var hs-var">closureVar</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159022"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure (Process (Either String a))
</span><a href="#local-6989586621679159021"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">IO (Closure (Process (Either String a)))
-&gt; Process (Closure (Process (Either String a)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Closure (Process (Either String a)))
 -&gt; Process (Closure (Process (Either String a))))
-&gt; IO (Closure (Process (Either String a)))
-&gt; Process (Closure (Process (Either String a)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Closure (Process (Either String a)))
-&gt; IO (Closure (Process (Either String a)))
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
forall a.
SerializableClosureProcess a
-&gt; MVar (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#closureVar"><span class="hs-identifier hs-var hs-var">closureVar</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159022"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- | The type of a function that takes a 'SerializableClosureProcess'</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- and runs the 'Closure' on a remote machine. In case the remote</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- machine returns a 'Left' value (i.e. an error), throws this value</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- wrapped in 'RemoteError' of type 'RemoteException'. May throw other</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- 'RemoteError's if remote execution fails in any way.</span><span>
</span><span id="line-288"></span><span class="hs-keyword">type</span><span> </span><span id="RemoteProcessRunner"><span class="annot"><a href="Hyperion.Remote.html#RemoteProcessRunner"><span class="hs-identifier hs-var">RemoteProcessRunner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679159020"><span class="annot"><a href="#local-6989586621679159020"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Binary</span></span><span> </span><span class="annot"><a href="#local-6989586621679159020"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679159020"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-type">SerializableClosureProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159020"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159020"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- | Starts a new remote worker and runs a user function, which is</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- supplied with 'RemoteProcessRunner' for running closures on that</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- worker. If a 'RemoteError' occurs, it is handled by the</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- 'onRemoteError' supplied in the 'WorkerLauncher'.</span><span>
</span><span id="line-295"></span><span id="local-6989586621679159295"><span id="local-6989586621679159296"><span class="annot"><a href="Hyperion.Remote.html#withRemoteRunProcess"><span class="hs-identifier hs-type">withRemoteRunProcess</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679159296"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hyperion.Remote.html#WorkerLauncher"><span class="hs-identifier hs-type">WorkerLauncher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159296"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#RemoteProcessRunner"><span class="hs-identifier hs-type">RemoteProcessRunner</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159295"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-300"></span><span id="withRemoteRunProcess"><span class="annot"><span class="annottext">withRemoteRunProcess :: WorkerLauncher j -&gt; (RemoteProcessRunner -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withRemoteRunProcess"><span class="hs-identifier hs-var hs-var">withRemoteRunProcess</span></a></span></span><span> </span><span id="local-6989586621679159018"><span class="annot"><span class="annottext">WorkerLauncher j
</span><a href="#local-6989586621679159018"><span class="hs-identifier hs-var">workerLauncher</span></a></span></span><span> </span><span id="local-6989586621679159017"><span class="annot"><span class="annottext">RemoteProcessRunner -&gt; Process a
</span><a href="#local-6989586621679159017"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="annottext">Process a
</span><a href="#local-6989586621679159016"><span class="hs-identifier hs-var">goWithRemote</span></a></span><span> </span><span class="annot"><span class="annottext">Process a -&gt; (RemoteError -&gt; Process a) -&gt; Process a
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679159015"><span class="annot"><span class="annottext">RemoteError
</span><a href="#local-6989586621679159015"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerLauncher j -&gt; RemoteError -&gt; Process a -&gt; Process a
forall j.
WorkerLauncher j -&gt; forall b. RemoteError -&gt; Process b -&gt; Process b
</span><a href="Hyperion.Remote.html#onRemoteError"><span class="hs-identifier hs-var hs-var">onRemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerLauncher j
</span><a href="#local-6989586621679159018"><span class="hs-identifier hs-var">workerLauncher</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteError
</span><a href="#local-6989586621679159015"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerLauncher j -&gt; (RemoteProcessRunner -&gt; Process a) -&gt; Process a
forall j a.
Show j =&gt;
WorkerLauncher j -&gt; (RemoteProcessRunner -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withRemoteRunProcess"><span class="hs-identifier hs-var">withRemoteRunProcess</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerLauncher j
</span><a href="#local-6989586621679159018"><span class="hs-identifier hs-var">workerLauncher</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteProcessRunner -&gt; Process a
</span><a href="#local-6989586621679159017"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621679159016"><span class="annot"><span class="annottext">goWithRemote :: Process a
</span><a href="#local-6989586621679159016"><span class="hs-identifier hs-var hs-var">goWithRemote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><span class="annottext">WorkerLauncher j -&gt; (NodeId -&gt; ServiceId -&gt; Process a) -&gt; Process a
forall j a.
Show j =&gt;
WorkerLauncher j -&gt; (NodeId -&gt; ServiceId -&gt; Process a) -&gt; Process a
</span><a href="Hyperion.Remote.html#withService"><span class="hs-identifier hs-var">withService</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerLauncher j
</span><a href="#local-6989586621679159018"><span class="hs-identifier hs-var">workerLauncher</span></a></span><span> </span><span class="annot"><span class="annottext">((NodeId -&gt; ServiceId -&gt; Process a) -&gt; Process a)
-&gt; (NodeId -&gt; ServiceId -&gt; Process a) -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679159014"><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159014"><span class="hs-identifier hs-var">workerNodeId</span></a></span></span><span> </span><span id="local-6989586621679159013"><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">RemoteProcessRunner -&gt; Process a
</span><a href="#local-6989586621679159017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteProcessRunner -&gt; Process a)
-&gt; RemoteProcessRunner -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679159012"><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159012"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>      </span><span id="local-6989586621679159011"><span class="annot"><span class="annottext">Closure (Process (Either String a))
</span><a href="#local-6989586621679159011"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
forall a.
SerializableClosureProcess a
-&gt; Process (Closure (Process (Either String a)))
</span><a href="Hyperion.Remote.html#getClosure"><span class="hs-identifier hs-var">getClosure</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159012"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621679159010"><span class="annot"><span class="annottext">AsyncResult (Either String a)
</span><a href="#local-6989586621679159010"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async (Either String a) -&gt; Process (AsyncResult (Either String a))
forall a. Async a -&gt; Process (AsyncResult a)
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">(Async (Either String a)
 -&gt; Process (AsyncResult (Either String a)))
-&gt; Process (Async (Either String a))
-&gt; Process (AsyncResult (Either String a))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">AsyncTask (Either String a) -&gt; Process (Async (Either String a))
forall a. Serializable a =&gt; AsyncTask a -&gt; Process (Async a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Process (Either String a) -&gt; AsyncTask (Either String a)
forall a. Process a -&gt; AsyncTask a
</span><span class="hs-identifier hs-var">task</span></span><span> </span><span class="annot"><span class="annottext">(Process (Either String a) -&gt; AsyncTask (Either String a))
-&gt; Process (Either String a) -&gt; AsyncTask (Either String a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure (SerializableDict (Either String a))
-&gt; NodeId
-&gt; Closure (Process (Either String a))
-&gt; Process (Either String a)
forall a.
(Binary a, Typeable a) =&gt;
Closure (SerializableDict a)
-&gt; NodeId -&gt; Closure (Process a) -&gt; Process a
</span><a href="Hyperion.CallClosure.html#call%27"><span class="hs-identifier hs-var">call'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableClosureProcess a
-&gt; Closure (SerializableDict (Either String a))
forall a.
SerializableClosureProcess a
-&gt; Closure (SerializableDict (Either String a))
</span><a href="Hyperion.Remote.html#staticSDict"><span class="hs-identifier hs-var hs-var">staticSDict</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess a
</span><a href="#local-6989586621679159012"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679159014"><span class="hs-identifier hs-var">workerNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Closure (Process (Either String a))
</span><a href="#local-6989586621679159011"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AsyncResult (Either String a)
</span><a href="#local-6989586621679159010"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">AsyncDone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679159007"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679159007"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Process a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679159007"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-comment">-- By throwing an exception out of withService, we ensure that</span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-comment">-- the offending worker will be sent the ShutDown signal,</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-comment">-- since withService uses 'bracket'</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">AsyncDone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679159006"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159006"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteError -&gt; Process a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(RemoteError -&gt; Process a) -&gt; RemoteError -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; RemoteErrorType -&gt; RemoteError
</span><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteErrorType -&gt; RemoteError) -&gt; RemoteErrorType -&gt; RemoteError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; RemoteErrorType
</span><a href="Hyperion.Remote.html#RemoteException"><span class="hs-identifier hs-var">RemoteException</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159006"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">AsyncFailed</span></span><span> </span><span id="local-6989586621679159004"><span class="annot"><span class="annottext">DiedReason
</span><a href="#local-6989586621679159004"><span class="hs-identifier hs-var">reason</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteError -&gt; Process a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(RemoteError -&gt; Process a) -&gt; RemoteError -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; RemoteErrorType -&gt; RemoteError
</span><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteErrorType -&gt; RemoteError) -&gt; RemoteErrorType -&gt; RemoteError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiedReason -&gt; RemoteErrorType
</span><a href="Hyperion.Remote.html#RemoteAsyncFailed"><span class="hs-identifier hs-var">RemoteAsyncFailed</span></a></span><span> </span><span class="annot"><span class="annottext">DiedReason
</span><a href="#local-6989586621679159004"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">AsyncLinkFailed</span></span><span> </span><span id="local-6989586621679159002"><span class="annot"><span class="annottext">DiedReason
</span><a href="#local-6989586621679159002"><span class="hs-identifier hs-var">reason</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteError -&gt; Process a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(RemoteError -&gt; Process a) -&gt; RemoteError -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; RemoteErrorType -&gt; RemoteError
</span><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteErrorType -&gt; RemoteError) -&gt; RemoteErrorType -&gt; RemoteError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiedReason -&gt; RemoteErrorType
</span><a href="Hyperion.Remote.html#RemoteAsyncLinkFailed"><span class="hs-identifier hs-var">RemoteAsyncLinkFailed</span></a></span><span> </span><span class="annot"><span class="annottext">DiedReason
</span><a href="#local-6989586621679159002"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><span class="annottext">AsyncResult (Either String a)
</span><span class="hs-identifier hs-var">AsyncCancelled</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteError -&gt; Process a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(RemoteError -&gt; Process a) -&gt; RemoteError -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; RemoteErrorType -&gt; RemoteError
</span><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteErrorType -&gt; RemoteError) -&gt; RemoteErrorType -&gt; RemoteError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoteErrorType
</span><a href="Hyperion.Remote.html#RemoteAsyncCancelled"><span class="hs-identifier hs-var">RemoteAsyncCancelled</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">AsyncResult (Either String a)
</span><span class="hs-identifier hs-var">AsyncPending</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteError -&gt; Process a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(RemoteError -&gt; Process a) -&gt; RemoteError -&gt; Process a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServiceId -&gt; RemoteErrorType -&gt; RemoteError
</span><a href="Hyperion.Remote.html#RemoteError"><span class="hs-identifier hs-var">RemoteError</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceId
</span><a href="#local-6989586621679159013"><span class="hs-identifier hs-var">serviceId</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteErrorType -&gt; RemoteError) -&gt; RemoteErrorType -&gt; RemoteError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoteErrorType
</span><a href="Hyperion.Remote.html#RemoteAsyncPending"><span class="hs-identifier hs-var">RemoteAsyncPending</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- | Catch any exception, log it, and return as a string. In this</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- way, errors will be logged by the worker where they occurred,</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- and also sent up the tree.</span><span>
</span><span id="line-322"></span><span id="local-6989586621679159261"><span class="annot"><a href="Hyperion.Remote.html#tryLogException"><span class="hs-identifier hs-type">tryLogException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679159261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679159261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-323"></span><span id="tryLogException"><span class="annot"><span class="annottext">tryLogException :: Process b -&gt; Process (Either String b)
</span><a href="Hyperion.Remote.html#tryLogException"><span class="hs-identifier hs-var hs-var">tryLogException</span></a></span></span><span> </span><span id="local-6989586621679158998"><span class="annot"><span class="annottext">Process b
</span><a href="#local-6989586621679158998"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process b -&gt; Process (Either SomeException b)
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">Process b
</span><a href="#local-6989586621679158998"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Process (Either SomeException b)
-&gt; (Either SomeException b -&gt; Process (Either String b))
-&gt; Process (Either String b)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158997"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679158997"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">SomeException -&gt; Process ()
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; a -&gt; m ()
</span><a href="Hyperion.Log.html#err"><span class="hs-identifier hs-var">Log.err</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679158997"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">Either String b -&gt; Process (Either String b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679158997"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679158995"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679158995"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">Either String b -&gt; Process (Either String b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Either String b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679158995"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | Construct a SerializableClosureProcess for evaluating the closure</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- 'mb' on a remote machine. The action 'mb' that produces the</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- 'Closure' will only be run once -- when a worker first becomes</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- available. The MVar 'v' caches the resulting Closure (so it can be</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- re-used in the event of an error and retry), which will then be</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- sent across the network.</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- Note that we wrap the given closure in tryLogException. Thus,</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- exception handling is added by catching any exception @e@, logging</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- @e@ with 'Log.err' (on the worker), and returning a 'Left' result</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- with the textual representation of @e@ from 'Show' instance.</span><span>
</span><span id="line-341"></span><span id="local-6989586621679158994"><span class="annot"><a href="Hyperion.Remote.html#mkSerializableClosureProcess"><span class="hs-identifier hs-type">mkSerializableClosureProcess</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679158994"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Dict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Serializable</span></span><span> </span><span class="annot"><a href="#local-6989586621679158994"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Closure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="annot"><a href="#local-6989586621679158994"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-type">SerializableClosureProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679158994"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-346"></span><span id="mkSerializableClosureProcess"><span class="annot"><span class="annottext">mkSerializableClosureProcess :: Closure (Dict (Serializable b))
-&gt; Process (Closure (Process b))
-&gt; Process (SerializableClosureProcess b)
</span><a href="Hyperion.Remote.html#mkSerializableClosureProcess"><span class="hs-identifier hs-var hs-var">mkSerializableClosureProcess</span></a></span></span><span> </span><span id="local-6989586621679158992"><span class="annot"><span class="annottext">Closure (Dict (Serializable b))
</span><a href="#local-6989586621679158992"><span class="hs-identifier hs-var">bDict</span></a></span></span><span> </span><span id="local-6989586621679158991"><span class="annot"><span class="annottext">Process (Closure (Process b))
</span><a href="#local-6989586621679158991"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621679158990"><span class="annot"><span class="annottext">MVar (Closure (Process (Either String b)))
</span><a href="#local-6989586621679158990"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (Closure (Process (Either String b))))
-&gt; Process (MVar (Closure (Process (Either String b))))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO (MVar (Closure (Process (Either String b))))
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="annottext">SerializableClosureProcess b
-&gt; Process (SerializableClosureProcess b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SerializableClosureProcess b
 -&gt; Process (SerializableClosureProcess b))
-&gt; SerializableClosureProcess b
-&gt; Process (SerializableClosureProcess b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerializableClosureProcess :: forall a.
Process (Closure (Process (Either String a)))
-&gt; Closure (SerializableDict (Either String a))
-&gt; MVar (Closure (Process (Either String a)))
-&gt; SerializableClosureProcess a
</span><a href="Hyperion.Remote.html#SerializableClosureProcess"><span class="hs-identifier hs-type">SerializableClosureProcess</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">runClosureProcess :: Process (Closure (Process (Either String b)))
</span><a href="Hyperion.Remote.html#runClosureProcess"><span class="hs-identifier hs-var">runClosureProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Closure (Process b) -&gt; Closure (Process (Either String b)))
-&gt; Process (Closure (Process b))
-&gt; Process (Closure (Process (Either String b)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">static</span><span> </span><span class="annot"><span class="annottext">Process b -&gt; Process (Either String b)
forall b. Process b -&gt; Process (Either String b)
</span><a href="Hyperion.Remote.html#tryLogException"><span class="hs-identifier hs-var">tryLogException</span></a></span><span> </span><span class="annot"><span class="annottext">StaticPtr (Process b -&gt; Process (Either String b))
-&gt; Closure (Process b) -&gt; Closure (Process (Either String b))
forall a b.
(Typeable a, Typeable b) =&gt;
StaticPtr (a -&gt; b) -&gt; Closure a -&gt; Closure b
</span><span class="hs-operator hs-var">`ptrAp`</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Process (Closure (Process b))
</span><a href="#local-6989586621679158991"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">staticSDict :: Closure (SerializableDict (Either String b))
</span><a href="Hyperion.Remote.html#staticSDict"><span class="hs-identifier hs-var">staticSDict</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">static</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Dict (Serializable b)
</span><span class="hs-identifier hs-var">Dict</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SerializableDict (Either String b)
forall a. Serializable a =&gt; SerializableDict a
</span><span class="hs-identifier hs-var">SerializableDict</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StaticPtr
  (Dict (Serializable b) -&gt; SerializableDict (Either String b))
-&gt; Closure (Dict (Serializable b))
-&gt; Closure (SerializableDict (Either String b))
forall a b.
(Typeable a, Typeable b) =&gt;
StaticPtr (a -&gt; b) -&gt; Closure a -&gt; Closure b
</span><span class="hs-operator hs-var">`ptrAp`</span></span><span> </span><span class="annot"><span class="annottext">Closure (Dict (Serializable b))
</span><a href="#local-6989586621679158992"><span class="hs-identifier hs-var">bDict</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">closureVar :: MVar (Closure (Process (Either String b)))
</span><a href="Hyperion.Remote.html#closureVar"><span class="hs-identifier hs-var">closureVar</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar (Closure (Process (Either String b)))
</span><a href="#local-6989586621679158990"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-353"></span></pre></body></html>